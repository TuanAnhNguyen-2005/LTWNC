@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "Chỉnh sửa người dùng";
}

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0"><i class="fas fa-user-edit me-2"></i>Chỉnh sửa người dùng</h5>
            </div>
            <div class="card-body">
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show">
                        <i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <form id="editUserForm" method="post" action="/User/Edit">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="userId" name="userId" value="@(ViewBag.User?.userId ?? ViewBag.User?.id)" />
                    
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="fullName" name="fullName" 
                               value="@(ViewBag.User?.fullName ?? ViewBag.User?.FullName)" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="email" name="email" 
                               value="@(ViewBag.User?.email ?? ViewBag.User?.Email)" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Mật khẩu mới</label>
                        <input type="password" class="form-control" id="password" name="password" minlength="6">
                        <small class="form-text text-muted">Để trống nếu không muốn đổi mật khẩu (tối thiểu 6 ký tự)</small>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
                    </div>

                    <div class="mb-3">
                        <label for="role" class="form-label">Vai trò <span class="text-danger">*</span></label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="">-- Chọn vai trò --</option>
                            <option value="Admin" selected="@(ViewBag.User?.role == "Admin" || ViewBag.User?.Role == "Admin")">Admin</option>
                            <option value="Teacher" selected="@(ViewBag.User?.role == "Teacher" || ViewBag.User?.Role == "Teacher")">Teacher</option>
                            <option value="Student" selected="@(ViewBag.User?.role == "Student" || ViewBag.User?.Role == "Student")">Student</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="phone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="phone" name="phone" 
                               value="@(ViewBag.User?.phone ?? ViewBag.User?.Phone)">
                    </div>

                    <div class="mb-3">
                        <label for="address" class="form-label">Địa chỉ</label>
                        <textarea class="form-control" id="address" name="address" rows="3">@(ViewBag.User?.address ?? ViewBag.User?.Address)</textarea>
                    </div>

                    <div class="mb-3">
                        <label for="isActive" class="form-label">Trạng thái</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="isActive" name="isActive" 
                                   checked="@(ViewBag.User?.isActive ?? ViewBag.User?.IsActive ?? true)">
                            <label class="form-check-label" for="isActive">Kích hoạt</label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="/User" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Quay lại
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Cập nhật
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            $('#editUserForm').on('submit', function(e) {
                var password = $('#password').val();
                var confirmPassword = $('#confirmPassword').val();
                
                if (password && password !== confirmPassword) {
                    e.preventDefault();
                    alert('Mật khẩu xác nhận không khớp!');
                    return false;
                }
            });
        });
    </script>
}

